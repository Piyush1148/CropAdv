{
  "model": "llama-3.3-70b-versatile",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert agricultural consultant with deep knowledge of Indian farming practices, soil science, crop management, and regional climate patterns. Provide detailed, actionable, and scientifically accurate farming guidance. ALWAYS respond in valid JSON format - no markdown code blocks, no backticks, just pure JSON starting with { and ending with }."
    },
    {
      "role": "user",
      "content": "Generate a comprehensive, personalized growing guide based on the following data:\n\n=== CROP INFORMATION ===\nCrop: {{ $json.cropName }}\nLocation: {{ $json.location }} ({{ $json.latitude }}°N, {{ $json.longitude }}°E)\nSeason: {{ $json.season }}\n\n=== SOIL ANALYSIS (From Recent Soil Test) ===\nSoil Type: {{ $json.soilType }}\nNitrogen (N): {{ $json.soilData.nitrogen }} kg/ha - {{ $json.soilData.nitrogen < 200 ? 'LOW - Needs supplementation' : $json.soilData.nitrogen < 300 ? 'MEDIUM - Moderate fertilization needed' : 'HIGH - Reduce fertilizer application' }}\nPhosphorus (P): {{ $json.soilData.phosphorus }} kg/ha - {{ $json.soilData.phosphorus < 25 ? 'LOW - Needs supplementation' : $json.soilData.phosphorus < 50 ? 'MEDIUM - Moderate fertilization needed' : 'HIGH - Reduce fertilizer application' }}\nPotassium (K): {{ $json.soilData.potassium }} kg/ha - {{ $json.soilData.potassium < 150 ? 'LOW - Needs supplementation' : $json.soilData.potassium < 280 ? 'MEDIUM - Moderate fertilization needed' : 'HIGH - Reduce fertilizer application' }}\npH Level: {{ $json.soilData.ph }} - {{ $json.soilData.ph < 6.0 ? 'ACIDIC - Needs lime application' : $json.soilData.ph > 7.5 ? 'ALKALINE - Needs sulfur/gypsum' : 'OPTIMAL for most crops' }}\nRecent Rainfall: {{ $json.soilData.rainfall }}mm\n\n=== FARM DETAILS ===\nFarm Size: {{ $json.farmSize }} acres\nIrrigation System: {{ $json.irrigationType }}\n\n=== WEATHER FORECAST (Next 7 Days) ===\n{{ $input.all()[1].json.weatherData ? 'Temperature: ' + $input.all()[1].json.weatherData.temperature + '°C, Humidity: ' + $input.all()[1].json.weatherData.humidity + '%, Conditions: ' + $input.all()[1].json.weatherData.description : 'Weather data available from previous nodes' }}\nClimate Suitability: {{ $input.all()[1].json.climateSuitability || 'Good' }}\n\n=== SOIL COMPOSITION (SoilGrids Data) ===\n{{ $input.all()[3].json.soilComposition ? 'pH: ' + $input.all()[3].json.soilComposition.ph + ', Nitrogen: ' + $input.all()[3].json.soilComposition.nitrogen + ', Clay: ' + $input.all()[3].json.soilComposition.clay + '%, Sand: ' + $input.all()[3].json.soilComposition.sand + '%' : 'Soil data available from previous nodes' }}\n\n=== INSTRUCTIONS ===\nBased on the ACTUAL soil test results provided above (especially N={{ $json.soilData.nitrogen }}, P={{ $json.soilData.phosphorus }}, K={{ $json.soilData.potassium }}, pH={{ $json.soilData.ph }}), create a comprehensive, personalized growing guide with these 8 sections:\n\n1. LAND PREPARATION\n   - Specific tillage recommendations for {{ $json.soilType }}\n   - Field preparation timeline for {{ $json.farmSize }} acres\n   - Soil amendments needed based on pH {{ $json.soilData.ph }}\n\n2. SEED SELECTION & SOWING\n   - Best varieties for {{ $json.location }} in {{ $json.season }} season\n   - Seed rate calculation for {{ $json.farmSize }} acres\n   - Optimal sowing dates for {{ $json.location }}\n   - Seed treatment recommendations\n\n3. IRRIGATION MANAGEMENT\n   - Water requirements for {{ $json.irrigationType }} system\n   - Irrigation schedule adjusted for {{ $json.soilData.rainfall }}mm recent rainfall\n   - Critical irrigation stages\n   - Water calculation for {{ $json.farmSize }} acres\n\n4. FERTILIZER MANAGEMENT\n   ⚠️ CRITICAL: Use ACTUAL soil test values to calculate fertilizer needs:\n   - Current N level: {{ $json.soilData.nitrogen }} kg/ha\n   - Current P level: {{ $json.soilData.phosphorus }} kg/ha\n   - Current K level: {{ $json.soilData.potassium }} kg/ha\n   - Soil pH: {{ $json.soilData.ph }}\n   \n   Calculate PRECISE fertilizer recommendations:\n   - Base dose (at sowing) - exact quantities in kg for {{ $json.farmSize }} acres\n   - Top dressing schedule - when and how much\n   - Organic amendments if pH correction needed\n   - Total cost estimation in INR\n\n5. PEST & DISEASE MANAGEMENT\n   - Common pests in {{ $json.location }} region during {{ $json.season }}\n   - Weather-based disease risk assessment\n   - Preventive measures\n   - Integrated Pest Management (IPM) practices\n   - When to scout for pests\n\n6. CROP CARE CALENDAR\n   - Week-by-week schedule from sowing to harvest\n   - Growth stage milestones\n   - Monitoring checklist\n   - Critical care periods\n\n7. HARVESTING GUIDELINES\n   - Maturity indicators\n   - Optimal harvest timing for {{ $json.location }} climate\n   - Harvesting method\n   - Expected yield for {{ $json.farmSize }} acres\n   - Post-harvest handling\n\n8. COST-BENEFIT ANALYSIS\n   - Input costs breakdown for {{ $json.farmSize }} acres:\n     * Seeds\n     * Fertilizers (based on calculated needs)\n     * Pesticides\n     * Labor\n     * Irrigation\n   - Expected revenue based on typical yields\n   - Break-even analysis\n   - Profitability estimation\n\nIMPORTANT GUIDELINES:\n- Use SPECIFIC numbers, not ranges\n- Scale ALL recommendations to {{ $json.farmSize }} acres\n- Base fertilizer advice on ACTUAL soil test values (N={{ $json.soilData.nitrogen }}, P={{ $json.soilData.phosphorus }}, K={{ $json.soilData.potassium }})\n- Consider {{ $json.irrigationType }} irrigation type in water calculations\n- Adjust for {{ $json.season }} season and {{ $json.location }} climate\n- Provide actionable, practical advice\n\nYOU MUST RESPOND WITH PURE JSON ONLY - NO MARKDOWN, NO ```json BLOCKS, NO ADDITIONAL TEXT BEFORE OR AFTER.\n\nReturn this exact JSON structure:\n{\n  \"cropName\": \"string\",\n  \"location\": \"string\",\n  \"season\": \"string\",\n  \"generatedAt\": \"ISO date string\",\n  \"summary\": {\n    \"climateSuitability\": \"good/excellent/moderate\",\n    \"soilQuality\": \"good/excellent/moderate\",\n    \"estimatedYield\": \"X quintals/acre\",\n    \"totalDuration\": \"X days/months\"\n  },\n  \"timeline\": {\n    \"landPreparation\": \"X weeks\",\n    \"sowingPeriod\": \"Month-Month\",\n    \"firstHarvest\": \"X days after sowing\",\n    \"totalDuration\": \"X months\"\n  },\n  \"sections\": [\n    {\"title\": \"Land Preparation\", \"content\": \"Detailed content with specific numbers for the farm size\"},\n    {\"title\": \"Seed Selection & Sowing\", \"content\": \"Detailed content\"},\n    {\"title\": \"Irrigation Management\", \"content\": \"Detailed content for the irrigation system\"},\n    {\"title\": \"Fertilizer Management\", \"content\": \"Based on actual NPK and pH values with exact calculations\"},\n    {\"title\": \"Pest & Disease Management\", \"content\": \"Detailed content\"},\n    {\"title\": \"Crop Care Calendar\", \"content\": \"Week-by-week schedule\"},\n    {\"title\": \"Harvesting Guidelines\", \"content\": \"Detailed harvesting instructions\"},\n    {\"title\": \"Cost-Benefit Analysis\", \"content\": \"Complete financial breakdown\"}\n  ]\n}\n\nSTART YOUR RESPONSE WITH { AND END WITH } - NOTHING ELSE."
    }
  ],
  "temperature": 0.7,
  "max_tokens": 4000,
  "top_p": 0.9
}
